@page "/details/{id}"
@using Maskinliste.Shared.ViewModels
@using Microsoft.AspNetCore.Components.WebAssembly.Authentication
@using Maskinliste.Client.Infrastructure
@inject IApiClient Api
@inject NavigationManager NavigationManager

<h3>MachineDetails</h3>
@if (machine == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <h1>@machine.Name</h1>
    <p>@machine.Details</p>
    <button class="btn btn-dark" @onclick="Delete">Delete Machine</button>
}

@code {
    [Parameter]
    public string Id { get; set; }

    private MachineDetailsViewModel machine;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            this.machine = await this.Api.GetMachineDetailsAsync(int.Parse(Id));
        }
        catch (AccessTokenNotAvailableException exception)
        {
            exception.Redirect();
        }
    }

    private async void Delete()
    {
        await this.Api.DeleteMachineAsync(int.Parse(Id));
        this.NavigationManager.NavigateTo("/");
    }
}
